实践名称：单片机应用开发实践

实践实践：9-11周
实践单位：计算机学院
教学单位： 计算机学院



1、实践目的

     单片机应用开发实践课程主要完成对UART、LED点阵、基于定时器的音乐播放器等模块，弥补《单片机及其应用开发》课程 实验课不能覆盖
所有教学内容的不足，并通过相对综合的实践项目进一步提高对单片机应用开发技术的理解和知识运用能力。

2、实践内容

   实践平台既可以采用单片机教学平台，也可以使用基于Protues的仿真平台。主要实践项目包括 具有校准功能的时钟，16×64LED点阵的汉字显示、
LED点阵汉字滚动显示，UART串口实验等，并综合各个功能模块设计一个小的课程作品。

3、实践安排

  具有校准功能的时钟： 4学时
  16×64LED点阵的汉字显示： 2学时
  LED点阵汉字滚动显示：4学时
  UART串口实验：4学时
  作品设计： 2学时

4、实践指导书

   《AVR单片机嵌入式系统原理与应用实践》




一、具有校准功能的时钟

如上图所示，硬件有两个按键和一个数码管，另外还有一个HC595；首先先将对应的GPIO口置为输入或输出，另外设置了一个两毫秒的中断，每进一次中断给HC595送数（HC595_send_byte），
通过PD4-PD7给数码管选位，从而实现动态扫描；其次，再编写状态机得到read_key()函数；当计数到10毫秒时，扫描按键，可实现选位闪烁调时功能，计数到一秒时数码管数值加一。




二、16×64LED点阵的汉字显示
如左图，硬件有HC595和译码器另外加点阵的支持；显示汉字时，注意先送后面的子模而且高位要先送，否则字会反了；进行送数时，注意需要把四个要显示的字的每两个字节做为一组数据发送
给级联的HC595，然后选择正确的行数进行点亮；然后在中断里面循环此过程，就可以显示静态汉字。
汉字滚动显示时，分为汉字无移出，移出八列以内，刚好八列和超过八列这四种情况；无移出时和静态显示一样送数，移出八列以内时，第一个字的前一个字数只需送8-（移出列数）位数，后一个字节正常
送数，第二三四个数全数送，第五个字送前一个字节的移出列数位数；其余两种情况类似；这样就可以实现逐列移位。
给HC595送数时需注意吧OE端先置为高阻态，待送数完成时再导通；否则会出现汉字显示不全问题。






三、UART串口实验
该实验的硬件设备由软件提供；首先用ICCAVR的APP Building初始化串口，晶振为7.3728M，波特率设为9600；在其接收中断设置当接收到0x00时，返回0xff;
打开串口调试助手，设置波特率为9600，连接好单片机；用串口调试助手给单片机发送0x00时，就会收到0xff。



四、作品设计
完成了一个有三个小程序的界面，分别为计时器、音乐播放器和飞机大战小游戏；程序一启动就会进入main_menu()函数，显示选择这三个功能的界面，通过read_key()函数扫描按键，获取按键状态，
当按下SW8时，实现对这三个程序的选择，按下KEY1按键时，确认进入该程序。
选择计时器时，进入menu1_choose()和menu1_work()函数循环，功能跟上面所述的具有校准功能的时钟一样，长按KEY1时可退出，返回到main_menu()函数。
选择音乐播放器时，进入menu2_choose()和menu2_work()函数循环；音乐播放器播放音乐功能主要由time1定时/计数器实现，程序定义了一个数组存在乐曲的音符和节拍所对应的计数值，每当播放完
一个音符时，重新取值进行计数，每一次比较匹配时，将PA3输出的值取反，这样就实现了给无源蜂鸣器一定的频率的波形使其“唱歌”；此时的SW8就是播放(暂停)按键，控制歌曲的进度，短按key1
可以选择下一首歌曲，长按key1可以退出音乐播放器回到main_menu()函数界面。
飞机大战小游戏主要思路：，用10ms判定按键，实现飞机的左右移动，此时需要清除当前飞机位置和重新绘制移动后飞机的位置，长按按键时可以发射子弹；每隔1S重新绘制游戏界面，期间夹杂了
子弹打中敌机的判定，这个是这个程序比较麻烦的一点，需要对子弹在不同行之间和与之对应敌机之间的判定，如果判定为子弹打中敌机，那么清除子弹和敌机的位置；当己方飞机死亡时，结束游戏。































